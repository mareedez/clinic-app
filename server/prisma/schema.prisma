// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  PATIENT
  PHYSICIAN
  FRONT_DESK
  ADMIN
}

enum AppointmentStatus {
  SCHEDULED
  CHECKED_IN
  IN_PROGRESS
  CANCELLED
  COMPLETED
  NO_SHOW
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  firstName    String
  lastName     String
  role         UserRole @default(PATIENT)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  patientProfile   PatientProfile?
  physicianProfile PhysicianProfile?

  createdAppointments Appointment[] @relation("CreatedBy")

  @@map("users")
}

model PatientProfile {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  phone       String?
  dateOfBirth DateTime?

  appointments Appointment[] @relation("PatientAppointments")

  @@map("patient_profiles")
}

model PhysicianProfile {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  specialization    String
  workingHoursStart String @default("09:00")
  workingHoursEnd   String @default("17:00")
  workingDays       Int[]

  appointments Appointment[] @relation("PhysicianAppointments")

  @@map("physician_profiles")
}

model Appointment {
  id          String            @id @default(uuid())
  status      AppointmentStatus @default(SCHEDULED)
  serviceType String
  notes       String?           @db.Text

  scheduledStartAt DateTime
  durationMinutes  Int      @default(30)

  checkedInAt  DateTime?
  startedAt    DateTime?
  completedAt  DateTime?
  cancelledAt  DateTime?
  cancelReason String?
  noShowAt     DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  createdById String
  createdBy   User   @relation("CreatedBy", fields: [createdById], references: [id])

  patientId String
  patient   PatientProfile @relation("PatientAppointments", fields: [patientId], references: [id])

  physicianId String
  physician   PhysicianProfile @relation("PhysicianAppointments", fields: [physicianId], references: [id])

  @@index([physicianId, scheduledStartAt])
  @@index([patientId])
  @@map("appointments")
}
